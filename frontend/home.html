<style>
</style>
<div id="home_div" style="max-width: 1200px; margin: 0 auto;">
  <h1>친치로(딜러 눈은 3으로 가정)</h1>
  <div>
    <div id="dice_money">총 금액 : <span>10000</span>원</div>
    <div id="bet_money">베팅 금액 : <input type="number" value="1000"></input>원</div>
    <dice-element class = "dice" style="margin: 20px; display: inline-block;"></dice-element>
    <dice-element class = "dice" style="margin: 20px; display: inline-block;"></dice-element>
    <dice-element class = "dice" style="margin: 20px; display: inline-block;"></dice-element>
    <button style="display: block; margin: 30px auto; font-size: 40px;" onclick="roll()">굴려</button>
  </div>
  <div id="gist"></div>
</div>  
<script>
  loadPage = () =>  {
    const dom = Gist.getGistDom("4dfb24deb5f079a12831f4222bda4329");
    document.getElementById('gist').appendChild(dom);
  }

  function roll(){
        const totalmoney = document.getElementById('dice_money').querySelector('span')
        const betMoney = document.getElementById('bet_money').querySelector('input')

        let cnt = 3;
        const values = [0,0,0];
        let idx = 0
        Array.from(document.getElementsByClassName('dice')).map(dice => dice.rollDice((value) => {
          values[idx++] = value;
          console.log('구름' + values.join(" "))
          if (!values.includes(0)){
            console.log('다구름')
            values.sort();
            
            switch (values) {
              case [1,2,3]:
                // 히후미 2배 뺏김
                totalmoney.innerText = parseInt(totalmoney.innerText) - (parseInt(betMoney.value) * 2);
                break;
              case [1,1,1]:
                // 핀조로 5배
                totalmoney.innerText = parseInt(totalmoney.innerText) + (parseInt(betMoney.value) * 5);
                break;
              case [2,2,2]:
              case [3,3,3]:
              case [4,4,4]:
              case [5,5,5]:
              case [6,6,6]:
                // 아라시 3배
                totalmoney.innerText = parseInt(totalmoney.innerText) + (parseInt(betMoney.value) * 3);
                break;
              case [4,5,6]:
                // 시고로 2배
                totalmoney.innerText = parseInt(totalmoney.innerText) + (parseInt(betMoney.value) * 2);
                break;
              default:
                if (hasEye(values)){
                  // 눈 있음
                  const eye = getEye(values)
                  MyToast.showToast("당신의 눈: " + eye.toString())
                  if (parseInt(eye) == 3) {
                    cnt--;
                    if (cnt > 0) roll();
                    else {
                      MyToast.showToast("당신의 패배...");
                      cnt = 3;
                    }
                  }
                } else {
                  // 눈 없음 다시 돌리기
                  MyToast.showToast("눈 없음 다시!")
                  cnt--;
                  if (cnt > 0) roll();
                  else {
                    MyToast.showToast("당신의 패배...");
                    cnt = 3;
                  }
                }
            }
          }
        }))
      }

      function hasEye(arr){
        return arr[0] == arr[1] || arr[1] == arr[2] || arr[2] == arr[0];
      }

      function getEye(arr){
        if (arr[0] == arr[1]) {
          return arr[2]
        } else if (arr[1] == arr[2]){
          return arr[0]
        }
        return arr[1]
      }
</script>